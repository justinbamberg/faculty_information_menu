<div style="max-width: 600px; margin: 0 auto; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; border-radius: 8px 8px 0 0; transition: background-color 0.3s ease; outline: none;">Faculty Training</summary>
<div style="padding: 15px; background-color: #f9f9f9; border-radius: 0 0 8px 8px;">
<div data-target="content">
<div>
<h2>Faculty Training</h2>
</div>
<h3>eLearning Office Video Series</h3>
Release Conditions: Checklists -&nbsp;<a rel="noopener" target="_blank" href="https://youtu.be/i2P50JK-law">https://youtu.be/i2P50JK-la</a></div>
<div data-target="content">Release Conditions: Assignments - <a rel="noopener" target="_blank" href="https://youtu.be/ybtLMV2xCro">https://youtu.be/ybtLMV2xCro</a></div>
<div data-target="content">Special Access: <a rel="noopener" target="_blank" href="https://youtu.be/GeYRX_QlHOQ">https://youtu.be/GeYRX_QlHOQ</a></div>
<div data-target="content">Accessing OneDrive through D2L - <a rel="noopener" target="_blank" href="https://youtu.be/b-PzEVpcNHM">https://youtu.be/b-PzEVpcNHM</a></div>
<div data-target="content">Uploading Assignments through OneDrive - <a rel="noopener" target="_blank" href="https://youtu.be/1yxksJZJkUY">https://youtu.be/1yxksJZJkUY</a></div>
<div data-target="content">Creating an Assignment - <a rel="noopener" target="_blank" href="https://youtu.be/-3o17TX84vg">https://youtu.be/-3o17TX84vg</a>&nbsp;<br><a href="https://youtu.be/xTI10zdH3eI?si=YTHYHG71FUuGv3g5" target="_blank" rel="noopener"></a>
<p style="list-style-type: decimal;">Read more:<a rel="noopener" target="_blank" href="https://www.youtube.com/playlist?list=PLxVrh4HERfmlVFce7GLxFqBoTYMuHtN5v"> Series Overview</a><a rel="noopener" target="_blank" href="https://community.d2l.com/brightspace/kb/articles/26508-bright-ideas-for-higher-education-series-overview"></a></p>
</div>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">D2L Webinars</summary>
<div style="padding: 15px; background-color: #f9f9f9; border-radius: 0 0 8px 8px;">
<div data-target="content">
<div>
<h2>D2L Webinar</h2>
</div>
<h3>Bright Ideas for Higher Education - Series Overview</h3>
<p>Each webinar is 45 minutes followed by 15 minutes of Q&amp;A and Discussion. Take a deep dive with our Adoption Team into Brightspace tips and tricks for better higher education learning experiences! &nbsp;</p>
<p>**Join us at 1:00pm EST on the following days by registering&nbsp;<a rel="noopener" href="https://d2l.zoom.us/webinar/register/7217241589332/WN_hQ6i-XaOTRGVTcR3i4OTkg" target="_blank" previewlistener="true">HERE</a>&nbsp;**&nbsp;</p>
<ol style="list-style-type: none;">
<li style="list-style-type: decimal;"><a href="https://youtu.be/xTI10zdH3eI?si=YTHYHG71FUuGv3g5" target="_blank" rel="noopener">Getting Started With Brightspace</a> (9/10/24)&nbsp;</li>
<li style="list-style-type: decimal;"><a href="https://youtu.be/Kdm-6eqgR64?si=8W1kMYApRlAFWSsY" target="_blank" rel="noopener">Optimizing Student Engagement in Brightspace</a> (10/9/24)&nbsp;</li>
<li style="list-style-type: decimal;">PART 1 of the Assessment Mini-Series: <a href="https://youtu.be/wPmj-SWc95Q?si=m7ndghQvINNPTScQ" target="_blank" rel="noopener">Creating Assessments in Brightspace</a> (11/9/24)&nbsp;</li>
<li style="list-style-type: decimal;">PART 2 of the Assessment Mini-Series: <a href="https://youtu.be/jek9QpNNDWs?si=VJbNNGTtabJ-Iy13" target="_blank" rel="noopener">Assessment and Feedback in Brightspace</a> (12/11/24)&nbsp;</li>
<li style="list-style-type: decimal;">PART 3 of the Assessment Mini-Series: <a href="https://youtu.be/j5t9FtTS1R8?si=nTRqNtQu889eE5T5" target="_blank" rel="noopener">Evaluation in Brightspace</a> (1/8/25)&nbsp;</li>
<li style="list-style-type: decimal;"><a href="https://youtu.be/dRylHTchrCU?si=Xi65_JtE3N1iLfWj" target="_blank" rel="noopener">Course Design Best Practice in Higher Ed</a> (2/12/25)&nbsp;</li>
<li style="list-style-type: decimal;"><a href="https://youtu.be/sIr0c9MUMVk?si=WnoGvHqQcGbwb_sl" target="_blank" rel="noopener">Accessibility in Higher Education</a> - (3/12/25)</li>
</ol>
<p style="list-style-type: decimal;">Read more: <a rel="noopener" target="_blank" href="https://community.d2l.com/brightspace/kb/articles/26508-bright-ideas-for-higher-education-series-overview">Series Overview</a></p>
</div>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Course Merge Request</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<h3><strong>Course merge request - Courses Merge Requests are in Progress for Spring/Summer!</strong></h3>
<p>Course Merging is combining multiple sections of the same course. An example is if you are teaching ABC-101-FA800, ABC-101-FA810 and ABC-101-FA820 you can request to have them combined into one D2L course shell by filling out the form below.</p>
<ol>
<li>Course merge requests are not done immediately, but only during the time specified on the form.</li>
<li>You can develop and prepare your "main" course ahead of time and do not need to wait for the merge to finish.</li>
<li>Course merge request need to be completed at least 2 days before the class starts.</li>
<li>We do not merge courses where students have started doing activities and receiving grades.&nbsp;</li>
</ol>
<p>Note: The DCFA states in Article 8.3.F that Multiple online sections of the same asynchronous course may be managed in a single course shell, for consistent communication of content and announcements.&nbsp;</p>
<p><a href="https://elearning.delta.edu/content/ZohoCourseMergewithAPIs/Coursemergerequest-25FA.html" target="_blank" rel="noopener">NEW - Course Merge Request form for Fall 2025</a></p>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Help Desk</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<p><strong>Technical problems using D2L/eLearning software?</strong></p>
<ul>
<li>Use <a rel="noopener" target="_blank" href="https://deltacollege.zohodesk.com/portal/">Help Desk Form</a></li>
<li>Contact us at <a href="mailto:elearning@delta.edu">elearning@delta.edu</a></li>
<li>Call <a href="tel:(989) 686-9401">(989) 686-9401</a></li>
</ul>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Student Support System</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<p>Do you have students that could benefit from TLC or Counseling services? Notify us to reach out to your students via&nbsp;<a contenteditable="false" target="_blank" href="https://employees.delta.edu/student-support-system/faculty.html" "="" title="Student Support System" rel="noopener">SSS</a>.&nbsp;</p>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Attendance Tracking</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<p>Attendance Tracking for Faculty - As a reminder, Delta College is requesting that you track your attendance in Faculty Self-Service by following this link - <a aria-label="Link https://ss.delta.edu/Student/Student/Faculty" title="https://ss.delta.edu/Student/Student/Faculty" href="https://ss.delta.edu/Student/Student/Faculty" rel="noopener noreferrer" target="_blank" tabindex="-1">https://ss.delta.edu/Student/Student/Faculty</a>&nbsp;</p>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Last Date of Attendance Info</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<p><strong>Never Attended Drop Information&nbsp;</strong></p>
<p>· &nbsp;Please review the&nbsp;<a contenteditable="false" href="https://students.delta.edu/records-registration/_documents/important-semester-dates.pdf" title="https://students.delta.edu/records-registration/_documents/important-semester-dates.pdf">Important Semester Dates</a>&nbsp;file to determine the end of the non-attendance period for your course. This date is also the end of refund and last date to add.</p>
<p>· &nbsp;Please review your attendance on your rosters and submit an <a rel="noopener" target="_blank" href="https://r.delta.edu/instructordropform">Instructor Initiated Drop form</a> for any student not in attendance</p>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Submit Grades By:</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<div id="instructor-courses-widget">
<h2>Submit Grades By:</h2>
<p style="font-size: 95%;">This widget is designed to give you a reminder when you need to submit final grades. Courses will always appear in the list even if you have submitted your grades.</p>
<div id="error-message" style="color: red; display: none;"></div>
<table id="courses-table" style="width: 100%;">
<tbody id="courses-table-body"><!-- Course rows will be dynamically added here --></tbody>
</table>
</div>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const errorMessageElement = document.getElementById('error-message');
    const tableBody = document.getElementById('courses-table-body');
    let filteredCourses = [];

    const renderTable = () => {
        tableBody.innerHTML = '';

        filteredCourses.forEach((course) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="display: flex; align-items: center; justify-content: space-between; padding: 5px 0;">
                    <a href="https://elearning.delta.edu/d2l/home/${course.id}" target="_blank"
                        style="text-decoration: underline; color: #0056b3; font-size: 12px; font-weight: bold; transition: color 0.3s ease; margin-right: 10px;"
                        onmouseover="this.style.color='#003d80';"
                        onmouseout="this.style.color='#0056b3';">
                        ${course.code}
                    </a>
                    <span style="font-size: 12px; color: #333;">Due: ${course.formattedDueDate}</span>
                </td>
            `;
            tableBody.appendChild(row);
        });
    };

    try {
        const whoami = await fetch('/d2l/api/lp/1.51/users/whoami', { credentials: 'include' })
            .then(res => res.json());

        const blockedUsers = ['justinbamberg', 'sheryljensen', 'errinmilkowski.d2l', 'kayleighnelson.d2l'];
        if (blockedUsers.includes(whoami.UniqueName)) {
            console.log("⛔ Widget skipped for admin user:", whoami.UniqueName);
            return;
        }

        console.log('Starting API request for enrollments...');
        let courses = [];
        let bookmark = '';
        let hasMoreItems = true;

        while (hasMoreItems) {
            const enrollments = await fetch(`/d2l/api/lp/1.47/enrollments/myenrollments/?bookmark=${bookmark}`, {
                credentials: 'include'
            }).then(response => {
                if (!response.ok) throw new Error('Failed to fetch course enrollments.');
                return response.json();
            });

            courses = courses.concat(enrollments.Items.map(item => {
                if (!item.OrgUnit || !item.OrgUnit.Type || item.OrgUnit.Type.Code !== 'Course Offering') return null;
                if (!item.Access || !item.Access.EndDate) return null;

                const nameMatch = item.OrgUnit.Name.match(/- ([A-Z]{3,4}-\d{3}-[A-Z]{2,3}\d{3})-/);
                const extractedCode = nameMatch ? nameMatch[1] : null;

                return {
                    id: item.OrgUnit.Id,
                    code: extractedCode || item.OrgUnit.Name,
                    fullName: item.OrgUnit.Name
                };
            }).filter(course => course !== null));

            hasMoreItems = enrollments.PagingInfo.HasMoreItems;
            bookmark = enrollments.PagingInfo.Bookmark;
        }

        const csvResponse = await fetch('https://elearning.delta.edu/content/api-apps/important-dates/semester_dates.csv');
        if (!csvResponse.ok) throw new Error('Failed to load CSV file.');
        const csvText = await csvResponse.text();
        const csvLines = csvText.split('\n').filter(l => l.trim() !== '');
        
        const csvHeaders = csvLines[0].split(',').map(header => header.trim());
        console.log("Parsed CSV Headers:", csvHeaders);

        const courseCodeIndex = csvHeaders.findIndex(header => header.toLowerCase() === 'course');
        const gradesDueIndex = csvHeaders.findIndex(header => header.toLowerCase() === 'final grades due');

        if (courseCodeIndex === -1 || gradesDueIndex === -1) {
            console.error("Expected headers 'Course' and 'Final Grades Due' not found. Headers found:", csvHeaders);
            throw new Error('CSV file is missing required headers "Course" and/or "Final Grades Due". Please check the file.');
        }

        const csvData = csvLines.slice(1).map(line => {
            const values = line.split(',');

            if (values[courseCodeIndex] && values[gradesDueIndex]) {
                const courseCode = values[courseCodeIndex].trim();
                const gradesDueDateStr = values[gradesDueIndex].trim();

                return {
                    courseCode: courseCode,
                    formattedDueDate: gradesDueDateStr
                };
            } else {
                console.warn(`Skipping incomplete or malformed line: ${line}`);
                return null;
            }
        }).filter(item => item !== null);

        // 🔁 Deduplicate based on course.code
        const seenCodes = new Set();
        filteredCourses = [];

        courses.forEach(course => {
            const match = csvData.find(csvCourse => csvCourse.courseCode.toLowerCase() === course.code.toLowerCase());
            if (match && !seenCodes.has(course.code.toLowerCase())) {
                seenCodes.add(course.code.toLowerCase());
                filteredCourses.push({
                    ...course,
                    formattedDueDate: match.formattedDueDate
                });
            }
        });

        console.log("Final Filtered Courses with Due Dates:", filteredCourses);
        renderTable();
    } catch (error) {
        console.error("An error occurred:", error);
        errorMessageElement.style.display = 'block';
        errorMessageElement.textContent = error.message;
    }
});
</script></div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Add a ZZStudent (Demo Student)</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<h3>Add a ZZStudent (Demo student)</h3>
<p>It is now possible as the instructor to enroll a ZZStudent (Demo Student) into your course. &nbsp;Follow this link or access the app from Faculty Forms navigation dropdown. &nbsp;This app will pull your current courses and allow you to add a ZZStudent to the course.</p>
<p><a rel="noopener" target="_blank" href="https://elearning.delta.edu/content/api-apps/Add%20ZZ%20Demo%20Student.html">Add ZZStudent</a></p>
</div>
</details>
<details style="border-bottom: 1px solid #ddd;">
<summary style="background-color: #005b4d; color: #fff; padding: 15px; margin: 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s ease; outline: none;">Create Sandbox Course</summary>
<div style="padding: 15px; background-color: #f9f9f9;">
<div style="max-width: 400px; margin: 0; margin-top: 20px;">
<h2>Create Sandbox Course</h2>
<p>This widget allows an Instructor to create a Sandbox course and enroll you as Instructor in the new course. This widget also creates a Demo Student (ZStudent) into the new course allowing you to impersonate and view the course as a full student.</p>
<p>If you need assistance with the widget, please contact the eLearning Office through the <a href="https://deltacollege.zohodesk.com/portal" target="_blank" rel="noopener"> Help Desk Ticketing System. </a></p>
<form id="courseForm">
<div style="margin-bottom: 1rem;"><label for="courseName">Course Name:</label> <input type="text" style="display: block; width: 100%; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; color: #495057; background-color: #fff; border: 1px solid #ced4da; border-radius: 0.25rem;" id="courseName" name="courseName" required="" oninput="updateCourseCode()"></div>
<div style="margin-bottom: 1rem;"><label for="courseCode">Course Code:</label> <input type="text" style="display: block; width: 100%; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; color: #495057; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 0.25rem;" id="courseCode" value="Sandbox-" readonly="readonly"></div>
<button type="button" id="createButton" style="display: inline-block; font-weight: 400; color: #ffffff; text-align: center; vertical-align: middle; user-select: none; background-color: #005b4d; border: 1px solid transparent; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; border-radius: 0.25rem; cursor: pointer; transition: background-color 0.3s ease;"> Create Sandbox Course </button></form>
<div id="successMessage" style="margin-top: 1rem;"></div>
<pre id="demo" style="margin-top: 1rem;"></pre>
</div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("createButton").addEventListener("click", createSandboxCourse);
    });

    function updateCourseCode() {
        const courseName = document.getElementById("courseName").value.trim();
        const formattedCourseName = courseName
            .replace(/\s+/g, '-')                   // Replace spaces with dashes
            .replace(/[^a-zA-Z0-9-_]/g, '')         // Remove invalid characters
            .substring(0, 40);                      // Limit to leave room for prefix
        document.getElementById("courseCode").value = `Sandbox-${formattedCourseName}`;
    }

    async function BrightspaceFetch(fetchMethod, fetchUrl, fetchData) {
        const headers = {
            "Content-Type": "application/json",
            "Access-Control-Origin": "*",
            "X-Csrf-Token": localStorage["XSRF.Token"],
        };

        const options = {
            method: fetchMethod,
            headers,
            credentials: "include"
        };

        if (fetchData !== null) {
            options.body = JSON.stringify(fetchData);
        }

        try {
            const res = await fetch(fetchUrl, options);
            const result = { status: res.status, data: {} };
            result.data = res.ok ? await res.json() : await res.text();
            return result;
        } catch (error) {
            return { status: 500, error: error.toString() };
        }
    }

    async function createSandboxCourse() {
        const courseName = document.getElementById("courseName").value.trim();
        if (!courseName) {
            alert("Please enter a course name.");
            return;
        }

        const formattedCourseName = courseName
            .replace(/\s+/g, '-')
            .replace(/[^a-zA-Z0-9-_]/g, '')
            .substring(0, 40);

        const sanitizedCourseCode = `Sandbox-${formattedCourseName}`;

        // Get instructor info
        const whoamiUrl = `https://${window.location.hostname}/d2l/api/lp/1.47/users/whoami`;
        const whoamiResult = await BrightspaceFetch("GET", whoamiUrl, null);
        if (whoamiResult.status !== 200) {
            document.getElementById("successMessage").innerHTML = "❌ Failed to retrieve instructor information.";
            return;
        }

        const instructorUserId = whoamiResult.data.Identifier;

        // Create course
        const courseData = {
            Name: courseName,
            Code: sanitizedCourseCode,
            CourseTemplateId: 2966247,
            Path: "",
            StartDate: null,
            EndDate: null,
            SemesterId: 2993337,
            LocaleId: null,
            ForceLocale: false,
            ShowAddressBook: false,
            Description: { Content: "", Type: "Text" },
            CanSelfRegister: false
        };

        const createCourseUrl = `https://${window.location.hostname}/d2l/api/lp/1.49/courses/`;
        const courseResult = await BrightspaceFetch("POST", createCourseUrl, courseData);

        if (courseResult.status !== 200 || !courseResult.data.Identifier) {
            document.getElementById("successMessage").innerHTML = `❌ Failed to create course "${courseName}".`;
            return;
        }

        const courseId = courseResult.data.Identifier;

        // Enroll instructor
        const enrollInstructor = {
            OrgUnitId: courseId,
            UserId: instructorUserId,
            RoleId: 102, // 🔁 Replace with actual Instructor RoleId if needed
            IsCascading: false
        };
        await BrightspaceFetch("POST", `https://${window.location.hostname}/d2l/api/lp/1.49/enrollments/`, enrollInstructor);

        // Create or reuse ZZStudent
        const zzUserName = `ZZDemoStudent-${courseId}`;
        const userCheckUrl = `https://${window.location.hostname}/d2l/api/lp/1.45/users/?userName=${zzUserName}`;
        const userCheck = await BrightspaceFetch("GET", userCheckUrl, null);

        let zzUserId;
        let demoStudentError = null;

        if (userCheck.status === 200 && userCheck.data.UserId) {
            zzUserId = userCheck.data.UserId;
        } else {
            const zzUserData = {
                OrgDefinedId: "",
                FirstName: "ZZDemo",
                MiddleName: "",
                LastName: "ZZStudent",
                ExternalEmail: "sandbox@delta.edu",
                UserName: zzUserName,
                RoleId: 112, // 🔁 Confirm actual Student Role ID
                IsActive: true,
                SendCreationEmail: false,
                Pronouns: ""
            };

            const userCreateUrl = `https://${window.location.hostname}/d2l/api/lp/1.45/users/`;
            const userCreate = await BrightspaceFetch("POST", userCreateUrl, zzUserData);

            if (userCreate.status === 200 && userCreate.data.UserId) {
                zzUserId = userCreate.data.UserId;
            } else {
                console.error("Failed to create ZZStudent:", userCreate);
                demoStudentError = userCreate;
            }
        }

        // Attempt to enroll ZZStudent if available
        if (zzUserId) {
            const enrollStudent = {
                OrgUnitId: courseId,
                UserId: zzUserId,
                RoleId: 112,
                IsCascading: false
            };

            const enrollStudentResult = await BrightspaceFetch(
                "POST",
                `https://${window.location.hostname}/d2l/api/lp/1.45/enrollments/`,
                enrollStudent
            );

            if (enrollStudentResult.status !== 200) {
                console.warn("Course created, but failed to enroll ZZStudent");
                demoStudentError = enrollStudentResult;
            }
        }

        // ✅ Final success message (even if ZZStudent failed)
        const courseLink = `https://${window.location.hostname}/d2l/home/${courseId}`;
        let successHTML = `<a href="${courseLink}" target="_blank">✅ Sandbox course "${courseName}" created. Click to view.</a>`;

        if (demoStudentError) {
            successHTML += `<br>⚠️ ZZStudent failed to create or enroll.`;
        }

        document.getElementById("successMessage").innerHTML = successHTML;
    }
</script></details>
</div>
